# Requirements Archive - FEC Donation Integration (v1.2)

**Milestone:** FEC Donation Integration
**Created:** 2026-02-11
**Archived:** 2026-02-14
**Status:** ALL REQUIREMENTS COMPLETE

## Environment & Foundation

- [x] **REQ-v1.2-001**: .env file loading for API key storage
  - dotenvy 0.15 loads .env at CLI startup (silent if missing)
  - OPENFEC_API_KEY validated only when donation commands invoked
  - .env.example template included with registration URL
  - .gitignore excludes .env files
  - **Outcome:** Shipped in Phase 7 Plan 1

- [x] **REQ-v1.2-002**: Congress-legislators FEC ID crosswalk
  - Downloads both current + historical YAML datasets
  - (last_name, state) composite key matching
  - Collision detection skips ambiguous matches with tracing::warn
  - fec_mappings table with composite PK (politician_id, fec_candidate_id)
  - sync-fec CLI command for population/refresh
  - **Outcome:** Shipped in Phase 7 Plan 2

## API Client

- [x] **REQ-v1.2-003**: OpenFEC API client module
  - openfec/ module with client.rs, types.rs, error.rs
  - 3 endpoints: candidate search, committee lookup, Schedule A contributions
  - Keyset pagination for Schedule A (last_index + last_contribution_receipt_date)
  - OpenFecError with RateLimited, InvalidApiKey, NotFound, Network, Parse variants
  - 15 wiremock integration tests
  - **Outcome:** Shipped in Phase 8 Plans 1-2

## Data Model & Mapping

- [x] **REQ-v1.2-004**: Schema v3/v4 migration
  - Schema v3: fec_mappings table
  - Schema v4: donations, donation_sync_meta, fec_committees tables + 5 indexes
  - Schema v5: employer_mappings, employer_lookup tables
  - Base DDL includes all columns for fresh DB creation
  - Migration tests for each version (idempotency verified)
  - **Outcome:** Shipped across Phase 7 Plan 1, Phase 9 Plan 1, Phase 12 Plan 2

- [x] **REQ-v1.2-005**: Politician-to-committee resolution pipeline
  - Three-tier cache: DashMap -> SQLite fec_mappings -> OpenFEC API
  - CommitteeResolver with CommitteeClass classification
  - Designation-first classification (leadership PACs check designation before type)
  - Empty results cached to prevent repeated API calls
  - 6 wiremock integration tests
  - **Outcome:** Shipped in Phase 9 Plan 2

## Sync Pipeline

- [x] **REQ-v1.2-006**: Donation sync command
  - sync-donations CLI with --db, --politician, --cycle, --batch-size flags
  - Concurrent pipeline: Semaphore + JoinSet + mpsc (concurrency = 3)
  - Keyset pagination with cursor persistence in donation_sync_meta
  - Deduplication by FEC sub_id (ON CONFLICT ignore)
  - Circuit breaker: 5 consecutive 429s = stop
  - Resume support: interrupted sync picks up from last cursor
  - Progress reporting with donation count and elapsed time
  - **Outcome:** Shipped in Phase 10 Plans 1-2

## Query & Display

- [x] **REQ-v1.2-007**: Donations CLI subcommand
  - donations CLI with --db (required), --politician, --cycle, --min-amount, --employer, --state, --top, --group-by
  - 4 display modes: individual, group-by contributor, employer, state
  - All 5 output formats (table, JSON, CSV, markdown, XML)
  - Input validation for all filter parameters
  - **Outcome:** Shipped in Phase 11 Plans 1-2

- [x] **REQ-v1.2-008**: Donation analysis aggregations
  - Top N donors by total contribution amount
  - Employer frequency analysis (count and total amount)
  - Geographic donor concentration (state-level breakdown)
  - Cycle filtering for 2-year election periods
  - **Outcome:** Shipped in Phase 11 Plans 1-2
  - **Note:** Max-out donor identification and committee-level breakdown deferred as non-critical analysis features

## Correlation & Integration

- [x] **REQ-v1.2-009**: Employer-to-issuer correlation
  - Employer normalization: lowercase, strip corporate suffixes, collapse whitespace
  - 52 seed employer-to-issuer mappings in TOML format (growth via export/import)
  - Jaro-Winkler fuzzy matching (0.85 threshold, configurable)
  - Confidence-scored suggestions: exact (1.0), fuzzy (0.85-0.99)
  - Export-review-import workflow via map-employers CLI
  - **Outcome:** Shipped in Phase 12 Plans 1-3

- [x] **REQ-v1.2-010**: Donation context in existing commands
  - --show-donor-context flag on trades command (top donors for traded sectors)
  - --show-donations flag on portfolio command (donation summary per politician)
  - Graceful no-op when no donation data exists
  - Output on stderr to preserve stdout for piped data formats
  - **Outcome:** Shipped in Phase 12 Plan 4

## Traceability

| Requirement | Phase | Status |
|-------------|-------|--------|
| REQ-v1.2-001 | Phase 7 | Complete |
| REQ-v1.2-002 | Phase 7 | Complete |
| REQ-v1.2-003 | Phase 8 | Complete |
| REQ-v1.2-004 | Phase 9 | Complete |
| REQ-v1.2-005 | Phase 9 | Complete |
| REQ-v1.2-006 | Phase 10 | Complete |
| REQ-v1.2-007 | Phase 11 | Complete |
| REQ-v1.2-008 | Phase 11 | Complete |
| REQ-v1.2-009 | Phase 12 | Complete |
| REQ-v1.2-010 | Phase 12 | Complete |

**Coverage:** 10/10 requirements complete (100%)

## Requirement Changes

- REQ-v1.2-004 scope expanded from "Schema v3" to include v4 and v5 migrations (natural evolution across phases)
- REQ-v1.2-008: Max-out donor identification and committee-level breakdown were deprioritized in favor of employer/contributor/state aggregations
- REQ-v1.2-009: Seed data shipped with 52 mappings instead of aspirational 200 (incremental growth path via export/import)

---
*Created: 2026-02-11*
*Archived: 2026-02-14*
