# Requirements Archive: v1.0 Detail Page Enrichment

**Archived:** 2026-02-09
**Status:** SHIPPED

For current requirements, see `.planning/REQUIREMENTS.md`.

---

# Requirements: Capitol Traders - Detail Page Enrichment

**Defined:** 2026-02-07
**Core Value:** Every synced record has complete data populated from detail pages, so downstream analysis works with real values instead of placeholders.

## v1 Requirements

### Foundation

- [x] **FOUND-01**: Fix upsert COALESCE direction so re-syncs do not overwrite enriched data with defaults -- v1.0
- [x] **FOUND-02**: Add `enriched_at` timestamp column to trades, politicians, and issuers tables -- v1.0
- [x] **FOUND-03**: Create Db query methods to find rows needing enrichment (NULL/default key fields) -- v1.0
- [x] **FOUND-04**: Add schema migration support (versioned ALTER TABLE for existing databases) -- v1.0

### Trade Enrichment

- [x] **TRADE-01**: Extend trade_detail scraper to extract asset_type from RSC payload -- v1.0
- [x] **TRADE-02**: Extend trade_detail scraper to extract size, size_range_high, size_range_low -- v1.0
- [x] **TRADE-03**: Extend trade_detail scraper to extract price (where available) -- v1.0
- [x] **TRADE-04**: Extend trade_detail scraper to extract filing_id and filing_url -- v1.0
- [x] **TRADE-05**: Investigate and extract committees from trade detail RSC payload (if available) -- v1.0 (implemented but unconfirmed on live RSC)
- [x] **TRADE-06**: Investigate and extract labels from trade detail RSC payload (if available) -- v1.0 (implemented but unconfirmed on live RSC)
- [x] **TRADE-07**: Populate trade_committees join table during sync -- v1.0
- [x] **TRADE-08**: Populate trade_labels join table during sync -- v1.0
- [x] **TRADE-09**: Smart-sync: skip trade detail fetch when all enrichable fields are non-NULL/non-default -- v1.0
- [x] **TRADE-10**: Batch commit checkpointing so enrichment can resume after crash -- v1.0
- [x] **TRADE-11**: Dry-run mode to preview what would be enriched without fetching -- v1.0

### Politician Enrichment

- [x] **POL-01**: Extract committee memberships via listing page committee-filter iteration (detail pages lack committee data) -- v1.0
- [x] **POL-02**: Populate politician_committees join table during sync -- v1.0
- [x] **POL-03**: Politician enrichment runs by default during sync (no opt-in flag) -- v1.0

### Issuer Enrichment

- [x] **ISS-01**: Extend issuer_detail scraper to extract performance data from RSC payload -- v1.0
- [x] **ISS-02**: Extend issuer_detail scraper to extract end-of-day price data -- v1.0
- [x] **ISS-03**: Populate issuer_performance table during sync -- v1.0
- [x] **ISS-04**: Populate issuer_eod_prices table during sync -- v1.0

### Concurrency / Performance

- [x] **PERF-01**: Bounded concurrency for detail requests (3-5 parallel via tokio Semaphore) -- v1.0
- [x] **PERF-02**: Progress bars for enrichment runs using indicatif -- v1.0
- [x] **PERF-03**: Circuit breaker that stops after N consecutive failures -- v1.0
- [x] **PERF-04**: Increased throttle delay for detail-page requests vs listing pages -- v1.0

### CLI Output

- [x] **OUT-01**: Surface asset_type, committees, labels in trade output (all formats: table, JSON, CSV, MD, XML) -- v1.0
- [x] **OUT-02**: Surface committee memberships in politician output (all formats) -- v1.0
- [x] **OUT-03**: Surface performance and EOD price data in issuer output (all formats) -- v1.0

## v2 Requirements

### Selective Enrichment

- **SEL-01**: Add --enrich-trades, --enrich-issuers flags to control which entity types get enriched
- **SEL-02**: Add --enrich-all flag as shorthand for enriching all entity types

### Monitoring

- **MON-01**: RSC payload canary test to detect Next.js format changes
- **MON-02**: Enrichment statistics report (rows enriched, skipped, failed per entity type)

### CLI Enhancements

- **CLI-01**: Add --from-db flag to read from SQLite instead of scraping (use enriched data)
- **CLI-02**: Eliminate redundant detail fetching in trades command (currently fetches unconditionally)

## Out of Scope

| Feature | Reason |
|---------|--------|
| External API enrichment (Congress API, market data) | All data comes from capitoltrades.com detail pages |
| BFF API fallback | Legacy API is unstable and not maintained |
| Headless browser rendering | RSC payloads contain structured data; DOM parsing unnecessary |
| Real-time price feeds | Only what capitoltrades.com provides |
| Full re-enrichment on every sync | Smart-skip is required for performance |
| Mobile or web UI | CLI tool only |

## Traceability

| Requirement | Phase | Status |
|-------------|-------|--------|
| FOUND-01 | Phase 1 | Satisfied |
| FOUND-02 | Phase 1 | Satisfied |
| FOUND-03 | Phase 1 | Satisfied |
| FOUND-04 | Phase 1 | Satisfied |
| TRADE-01 | Phase 2 | Satisfied |
| TRADE-02 | Phase 2 | Satisfied |
| TRADE-03 | Phase 2 | Satisfied |
| TRADE-04 | Phase 2 | Satisfied |
| TRADE-05 | Phase 2 | Satisfied |
| TRADE-06 | Phase 2 | Satisfied |
| TRADE-07 | Phase 3 | Satisfied |
| TRADE-08 | Phase 3 | Satisfied |
| TRADE-09 | Phase 3 | Satisfied |
| TRADE-10 | Phase 3 | Satisfied |
| TRADE-11 | Phase 3 | Satisfied |
| POL-01 | Phase 4 | Satisfied |
| POL-02 | Phase 4 | Satisfied |
| POL-03 | Phase 4 | Satisfied |
| ISS-01 | Phase 5 | Satisfied |
| ISS-02 | Phase 5 | Satisfied |
| ISS-03 | Phase 5 | Satisfied |
| ISS-04 | Phase 5 | Satisfied |
| PERF-01 | Phase 6 | Satisfied |
| PERF-02 | Phase 6 | Satisfied |
| PERF-03 | Phase 6 | Satisfied |
| PERF-04 | Phase 3 | Satisfied |
| OUT-01 | Phase 3 | Satisfied |
| OUT-02 | Phase 4 | Satisfied |
| OUT-03 | Phase 5 | Satisfied |

**Coverage:**
- v1 requirements: 29 total
- Satisfied: 29
- Unsatisfied: 0

---
*Requirements defined: 2026-02-07*
*Last updated: 2026-02-07 after roadmap creation*
