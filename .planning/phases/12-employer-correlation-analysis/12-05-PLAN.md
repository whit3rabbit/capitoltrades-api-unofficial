---
phase: 12-employer-correlation-analysis
plan: 05
type: execute
wave: 3
depends_on: ["12-03", "12-04"]
files_modified: []
autonomous: false

must_haves:
  truths:
    - "All workspace tests pass"
    - "No clippy warnings"
    - "All 4 Phase 12 success criteria are met"
  artifacts: []
  key_links: []
---

<objective>
Verify all Phase 12 features work end-to-end and the full test suite passes.

Purpose: Final checkpoint before Phase 12 is marked complete. Validates compilation, tests, and provides user with a summary of what was built and how to use it.

Output: Verification results and user-facing usage guide.
</objective>

<execution_context>
@/Users/whit3rabbit/.claude/get-shit-done/workflows/execute-plan.md
@/Users/whit3rabbit/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/12-employer-correlation-analysis/12-01-SUMMARY.md
@.planning/phases/12-employer-correlation-analysis/12-02-SUMMARY.md
@.planning/phases/12-employer-correlation-analysis/12-03-SUMMARY.md
@.planning/phases/12-employer-correlation-analysis/12-04-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Run full test suite and clippy verification</name>
  <files></files>
  <action>
    1. Run `cargo test --workspace` and verify ALL tests pass (existing + new Phase 12 tests).
    2. Run `cargo clippy --workspace` and verify zero warnings.
    3. Run `cargo check --workspace` to confirm clean compilation.
    4. Verify test count increased from Phase 11 baseline (473 tests) by the new Phase 12 tests.
    5. Verify `cargo run -p capitoltraders_cli -- --help` shows all subcommands including map-employers.
    6. Verify `cargo run -p capitoltraders_cli -- map-employers --help` shows export/import/load-seed.
    7. Verify `cargo run -p capitoltraders_cli -- trades --help` shows --show-donor-context.
    8. Verify `cargo run -p capitoltraders_cli -- portfolio --help` shows --show-donations.

    If any failures: fix them before proceeding to the checkpoint.
  </action>
  <verify>
    `cargo test --workspace` -- all pass, zero failures.
    `cargo clippy --workspace` -- zero warnings.
    All 4 new CLI flags/subcommands appear in --help output.
  </verify>
  <done>
    Full test suite passes. No clippy warnings. All new commands and flags registered and visible.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: User verification of Phase 12 features</name>
  <files></files>
  <action>
    Present the following to the user for verification:

    Phase 12: Employer Correlation and Analysis -- complete feature set:

    1. Employer mapping module (capitoltraders_lib/src/employer_mapping.rs):
       - normalize_employer(): strips corporate suffixes, lowercases, collapses whitespace
       - match_employer(): three-tier matching (exact -> fuzzy -> none) with configurable threshold
       - Blacklist for non-corporate employers (Retired, Self-employed, etc.)
       - Seed data: 40+ curated employer-to-issuer mappings in TOML

    2. Schema v5 (employer_mappings + employer_lookup tables):
       - Migration for existing databases
       - Fresh DB DDL includes new tables

    3. map-employers CLI command with 3 subcommands:
       - map-employers export -- exports unmatched employers with fuzzy suggestions to CSV
       - map-employers import -- imports confirmed mappings from edited CSV
       - map-employers load-seed -- bootstraps DB from curated TOML seed data

    4. Donor context in existing commands:
       - trades --show-donor-context -- shows top employers per traded sector
       - portfolio --show-donations -- shows donation summary per politician

    Ask the user to verify using these steps:

    Quick smoke test (does not require real data):

    1. Verify help output:
       cargo run -p capitoltraders_cli -- map-employers --help
       cargo run -p capitoltraders_cli -- trades --help | grep donor
       cargo run -p capitoltraders_cli -- portfolio --help | grep donation

    2. Verify compilation and tests:
       cargo test --workspace
       cargo clippy --workspace

    3. (Optional, if you have a synced database) Test with real data:
       capitoltraders map-employers load-seed --db trades.db
       capitoltraders map-employers export --db trades.db -o unmatched.csv
       capitoltraders trades --db trades.db --show-donor-context
       capitoltraders portfolio --db trades.db --politician P000197 --show-donations

    Phase 12 success criteria check:
    - [SC1] Employer names are normalized and matched with confidence scores
    - [SC2] --show-donor-context on trades shows donation context
    - [SC3] Portfolio includes optional donation summary
    - [SC4] Unmatched employers can be exported and re-imported

    Wait for user response: "approved" to mark Phase 12 complete, or description of issues.
  </action>
  <verify>
    User confirms all success criteria are met by typing "approved".
  </verify>
  <done>
    Phase 12 is complete. User has verified all features work as expected.
  </done>
</task>

</tasks>

<verification>
- Full test suite passes
- All Phase 12 success criteria verified
- User has confirmed the feature works as expected
</verification>

<success_criteria>
- All workspace tests pass (zero failures)
- Zero clippy warnings
- User approves the Phase 12 implementation
</success_criteria>

<output>
After completion, create `.planning/phases/12-employer-correlation-analysis/12-05-SUMMARY.md`
</output>
